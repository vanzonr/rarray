#!/bin/bash
# Not an autotools configure, just detects compiler for rarray.h 's Makefile
# Ramses van Zon, January 2014

set -e

if [ "$1" == "--help" ]; then
    
    echo "Detects compiler and libraries. Usage: configure [--prefix=PATH]"
    false
    
else
    
    if [ "${1:0:9}" == "--prefix=" ]; then
        prefix="${1:9}"
        shift
    elif [ "$1" == "--prefix" ]; then
        prefix="$2"
        shift 2
    else
        prefix="/usr/local"
    fi
    echo "Installation prefix set to '$prefix'."
    
    echo -n "Selecting C++ compiler... "
        
    for compiler in $CXX clang++ xlc++ icpc g++; do
        if which $compiler >& /dev/null; then
            compincmk="compiler.${compiler}.mk"
            if [ -f "$compincmk" ]; then                    
                echo $compiler
                CXX=$compiler
                break;
            fi
        fi
    done
    
    if [ -n "$compincmk" ]; then        
        echo "Copying $compincmk to compiler.mk"
        cp -f $compincmk compiler.mk
        echo "PREFIX=$prefix" >> compiler.mk
        echo "Use 'make test' to test rarray.h"
        echo "Use 'make benchmark' to benchmark rarray.h"
        echo "Use 'make install' to install rarray.h"
    else
        echo "compiler not found"
        false
    fi
    
fi

